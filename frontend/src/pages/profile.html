<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile - Mahika</title>
    <link rel="stylesheet" href="../css/common.css">
    <link rel="stylesheet" href="../css/admin.css">
</head>
<body style="background: #0a0a0a;">
    <div class="admin-form">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h2 style="margin: 0;">ðŸ‘¤ My Profile</h2>
            <button type="button" onclick="window.location.href='../index.html'" style="background: transparent; color: #e0e0e0; border: none; padding: 5px; cursor: pointer; font-size: 1.5rem; line-height: 1;">Ã—</button>
        </div>
        <div style="text-align: center; margin-bottom: 20px;">
            <div style="width: 80px; height: 80px; background: #667eea; border-radius: 50%; margin: 0 auto 10px; display: flex; align-items: center; justify-content: center; font-size: 2rem; color: white;">ðŸ‘¤</div>
            <h3 id="profile-name" style="color: #e0e0e0;">Guest User</h3>
            <p id="profile-email" style="color: #888;">guest@mahika.com</p>
        </div>
        <div style="margin-bottom: 20px;">
            <h3 style="color: #e0e0e0;">ðŸ“‹ Previous Orders</h3>
            <div id="order-history"></div>
        </div>
    </div>

    <script>
        let userProfile = JSON.parse(localStorage.getItem('userProfile')) || {
            name: 'Guest User',
            email: 'guest@mahika.com'
        };

        document.getElementById('profile-name').textContent = userProfile.name;
        document.getElementById('profile-email').textContent = userProfile.email;

        async function displayProfile() {
            const orderContainer = document.getElementById('order-history');
            orderContainer.innerHTML = '<p style="text-align: center; color: #666;">Loading orders...</p>';
            
            try {
                const response = await fetch(`http://localhost:8080/api/orders/email/${encodeURIComponent(userProfile.email)}`);
                const orders = await response.json();
                
                if (orders.length === 0) {
                    orderContainer.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">No previous orders</p>';
                    return;
                }
                
                orderContainer.innerHTML = orders.map(order => `
                    <div style="background: #000; padding: 15px; margin: 10px 0; border-radius: 8px; border: 1px solid #1e3a5f;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <strong style="color: #e0e0e0;">Order #${order.id}</strong>
                            <span style="color: #28a745; font-weight: bold;">${order.status}</span>
                        </div>
                        <p style="margin: 5px 0; color: #888;">Date: ${new Date(order.orderDate).toLocaleDateString()}</p>
                        <p style="margin: 5px 0; color: #888;">Items: ${order.items.length} products</p>
                        <p style="margin: 5px 0; color: #888;">Payment: ${order.paymentMethod} (${order.upiId})</p>
                        <p style="margin: 5px 0; font-weight: bold; color: #4a90e2;">Total: â‚¹${order.totalAmount}</p>
                    </div>
                `).join('');
            } catch (error) {
                orderContainer.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">No previous orders</p>';
            }
        }

        displayProfile();
    </script>
</body>
</html>
